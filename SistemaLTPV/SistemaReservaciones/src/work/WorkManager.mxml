<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%">

	<mx:MenuBar id="MainMenu" dataProvider="{_menuCollection}" x="0" y="0" width="100%" labelField="@label" itemClick="menuHandler(event);"/>
	<mx:SWFLoader source="assets/logo.swf" right="10" top="30" height="76"/>
	
	<mx:Script>
        <![CDATA[
        	import mx.com.latranquila.controller.Reservations;
        	import mx.com.latranquila.controller.Units;
        	import mx.com.latranquila.controller.Persons;
        	import mx.com.latranquila.auth.MenuRoleFilter;
        	import mx.controls.Menu;
        	import mx.collections.XMLListCollection;
        	import mx.rpc.events.FaultEvent;
        	import mx.rpc.events.ResultEvent;
        	import mx.core.IFlexDisplayObject;
        	import mx.com.latranquila.web.WebApplication;
        	import mx.rpc.remoting.RemoteObject;
        	import mx.events.MenuEvent;
        	import mx.collections.ArrayCollection;
        	import modulos.*;
            import mx.managers.PopUpManager;
            
            protected var _webApplication:WebApplication;
            protected var _configXML:XML;
            
			protected var _persons:Persons;
			protected var _reservations:Reservations;
			protected var _units:Units;
			
            
            [Bindable]
            protected var _menuCollection:XMLListCollection;
            // for testing
			private var _reservationsRO:RemoteObject;
           	
           	[Bindable]
           	private var _Modulos:ArrayCollection = new ArrayCollection([{_id:0,name:"Seleccionar",mdl:null},
           																{_id:2,name:"Datos Generales",mdl:DatosGenerales},
           																{_id:3,name:"ValidaciÃ³n",mdl:Validacion},
           																{_id:4,name:"Alta Clientes No Propietarios",mdl:AltaClientesNoPropietarios},
           																{_id:5,name:"Menu Principal",mdl:MainMenu},
           																{_id:6,name:"Reservaciones General",mdl:ReservacionesGeneral},
           																{_id:7,name:"Modulo Reservaciones General",mdl:ModuloReservacionesGeneral}	
           	])
            
			public function set context(contextObj:Object):void{
				for( var p:String in contextObj){
					if(this.hasOwnProperty(p)){
						this[p] = contextObj[p];
					}
				}
			}
            
			public function set persons(value:Persons):void{
				_persons = value;
			}
			public function set units(value:Units):void{
				_units = value;
			}
			public function set reservations(value:Reservations):void{
				_reservations = value;
				_reservations.getReservations();
			}            
            
            public function set webApplication(value:WebApplication):void{
            	_webApplication = value;
            	
				// for testing
				_reservationsRO = _webApplication.getService("reservations");            
				_reservationsRO.getReservations.addEventListener(ResultEvent.RESULT, getReservationsResult);
				_reservationsRO.getReservations.addEventListener(FaultEvent.FAULT, getReservationsFault);
				
				_reservationsRO.getReservations();
            }
            
            public function set configXML(value:XML):void{
            	_configXML = value;
            }
            
            public function logout(event:MenuEvent=null):void{
            	_webApplication.logout();
            }            
            
            public function enterState():void{
            	var filteredList:XMLList = MenuRoleFilter.filterMenuItemXMLList(_configXML.navMenu.menuitem, _webApplication.user);
            	_menuCollection = new XMLListCollection(filteredList);
            }
            
            public function exitState():void{
            	_menuCollection = new XMLListCollection();
            }
            
            
            protected function menuHandler(event:MenuEvent):void {	
            	if(event.item.@method != ""){
            		this[event.item.@method](event);
            	}
            }
            
            protected function  openPopup(event:MenuEvent):void{
            	if(event.item.@data !=0){
        			var pop:IFlexDisplayObject = PopUpManager.createPopUp(this,_Modulos[event.item.@data].mdl,false);
        			//pop.webApplication = _webApl
            	}
            }
            
            
            protected function getReservationsResult(event:ResultEvent):void{
            	
            }
            protected function getReservationsFault(event:FaultEvent):void{
            	
            }
            

         ]]>
    </mx:Script>
	
</mx:Canvas>
